<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>TERMINAL COCINA | Clandestino</title>
    <style>
        body { background: #000; color: #fff; font-family: 'Courier New', monospace; padding: 20px; }
        h1 { text-align: center; color: #d4af37; border-bottom: 3px double #d4af37; padding-bottom: 20px; }
        #panel { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 25px; }
        .ticket { background: #111; border: 2px solid #d4af37; padding: 20px; border-radius: 15px; }
        .direccion { background: #d4af37; color: #000; padding: 10px; font-weight: bold; margin-bottom: 15px; font-size: 1.1rem; }
        .item-box { border-bottom: 1px dashed #444; padding: 10px 0; }
        .quitar { color: #ff4444; font-weight: bold; display: block; margin-top: 5px; }
        .pago-info { margin-top: 15px; color: #00ff00; border: 1px solid #00ff00; padding: 10px; }
        .btn-listo { background: #d4af37; color: #000; border: none; width: 100%; padding: 15px; font-weight: bold; cursor: pointer; margin-top: 15px; border-radius: 10px; }
    </style>
</head>
<body>

    <h1>üìü PEDIDOS ENTRANTES</h1>
    <div id="panel">ESPERANDO PEDIDOS...</div>

    <script>
        const urlDB = "https://sandwich-clandestinos-default-rtdb.firebaseio.com/pedidos.json";

        async function cargar() {
            try {
                const res = await fetch(urlDB);
                const data = await res.json();
                const container = document.getElementById('panel');
                container.innerHTML = "";

                if (!data) {
                    container.innerHTML = "<h2>SIN PEDIDOS PENDIENTES</h2>";
                    return;
                }

                Object.keys(data).forEach(id => {
                    const p = data[id];
                    // El campo 'items' es un array ahora
                    let itemsHTML = p.items.map(i => `
                        <div class="item-box">
                            <strong>‚Ä¢ ${i.n}</strong>
                            <span class="quitar">‚ùå SIN: ${i.sin}</span>
                        </div>
                    `).join('');

                    container.innerHTML += `
                        <div class="ticket">
                            <div class="direccion">üìç ${p.direccion}</div>
                            <span style="font-size:0.8rem; color:#888;">HORA: ${p.hora}</span>
                            ${itemsHTML}
                            <div class="pago-info">
                                TOTAL: $${p.total}<br>
                                PAGA CON: $${p.pagaCon}<br>
                                CAMBIO: $${p.cambio > 0 ? p.cambio : 0}
                            </div>
                            <button class="btn-listo" onclick="completar('${id}')">PEDIDO ENTREGADO</button>
                        </div>
                    `;
                });
            } catch (e) { console.error("Error cargando datos"); }
        }

        async function completar(id) {
            if(confirm("¬øPedido listo?")) {
                await fetch(`https://sandwich-clandestinos-default-rtdb.firebaseio.com/pedidos/${id}.json`, { method: 'DELETE' });
                cargar();
            }
        }

        setInterval(cargar, 5000);
        cargar();
    </script>
</body>
</html>
