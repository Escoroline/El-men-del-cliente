<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Panel de Cocina | Clandestino</title>
    <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #000; color: #ff8c00; font-family: 'Courier Prime', monospace; margin: 0; padding: 20px; }
        h1 { text-align: center; border-bottom: 2px solid #ff8c00; padding-bottom: 10px; text-transform: uppercase; }
        #contenedor-pedidos { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .ticket-cocina { border: 2px solid #ff8c00; padding: 15px; background: #080808; position: relative; }
        .hora { color: #fff; font-size: 0.8rem; }
        .item-lista { color: #fff; margin: 10px 0; border-left: 3px solid #ff8c00; padding-left: 10px; }
        .btn-listo { background: #ff8c00; color: #000; border: none; padding: 10px; width: 100%; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-listo:hover { background: #fff; }
    </style>
</head>
<body>
    <h1>ðŸ“Ÿ PEDIDOS RECIBIDOS</h1>
    <div id="contenedor-pedidos">Cargando pedidos...</div>

    <script>
        const urlFirebase = "https://sandwich-clandestinos-default-rtdb.firebaseio.com/pedidos.json";

        async function cargarPedidos() {
            try {
                const respuesta = await fetch(urlFirebase);
                const datos = await respuesta.json();
                const contenedor = document.getElementById('contenedor-pedidos');
                contenedor.innerHTML = "";

                if (!datos) {
                    contenedor.innerHTML = "<h3>NO HAY PEDIDOS PENDIENTES</h3>";
                    return;
                }

                Object.keys(datos).forEach(id => {
                    const pedido = datos[id];
                    let itemsHTML = "";
                    pedido.items.forEach(i => {
                        itemsHTML += `<div class="item-lista">
                            <strong>${i.nombre}</strong><br>
                            <small>Extras: ${i.detalles}</small><br>
                            <small>Nota: ${i.nota || 'Sin notas'}</small>
                        </div>`;
                    });

                    contenedor.innerHTML += `
                        <div class="ticket-cocina">
                            <span class="hora">HORA: ${pedido.hora}</span>
                            <hr style="border:0; border-top:1px dashed #ff8c00">
                            ${itemsHTML}
                            <button class="btn-listo" onclick="completarPedido('${id}')">MARCAR COMO ENTREGADO</button>
                        </div>
                    `;
                });
            } catch (error) {
                console.error("Error al cargar:", error);
            }
        }

        async function completarPedido(id) {
            if(confirm("Â¿Pedido entregado? Se borrarÃ¡ de la pantalla.")) {
                await fetch(`https://sandwich-clandestinos-default-rtdb.firebaseio.com/pedidos/${id}.json`, {
                    method: 'DELETE'
                });
                cargarPedidos();
            }
        }

        // Refrescar cada 5 segundos
        setInterval(cargarPedidos, 5000);
        cargarPedidos();
    </script>
</body>
</html>
