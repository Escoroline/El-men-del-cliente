<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S치ndwich Clandestino | Carta Premium</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --dorado: #d4af37; --negro: #0a0a0a; --gris: #1a1a1a; --blanco: #e0e0e0; }
        body { background-color: var(--negro); color: var(--blanco); font-family: 'Montserrat', sans-serif; margin: 0; padding-bottom: 100px; background-image: radial-gradient(circle at 50% 50%, #1a1a1a 0%, #0a0a0a 100%); }
        header { text-align: center; padding: 50px 20px; border-bottom: 2px solid var(--dorado); background: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8)), url('https://www.transparenttextures.com/patterns/black-paper.png'); }
        h1 { font-family: 'Playfair Display', serif; font-size: 3rem; color: var(--dorado); margin: 0; text-transform: uppercase; letter-spacing: 5px; }
        .container { max-width: 900px; margin: auto; padding: 20px; }
        .section-header { display: flex; align-items: center; justify-content: center; margin: 40px 0; color: var(--dorado); font-family: 'Playfair Display'; font-size: 1.8rem; }
        .section-header::before, .section-header::after { content: ""; flex: 1; height: 1px; background: var(--dorado); margin: 0 20px; }
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        .menu-item { cursor: pointer; transition: 0.3s; padding: 15px; border-radius: 10px; border: 1px solid transparent; }
        .menu-item:hover { border: 1px solid var(--dorado); background: rgba(212, 175, 55, 0.05); }
        .item-header { display: flex; justify-content: space-between; border-bottom: 1px dotted var(--dorado); }
        .item-name { font-weight: 600; color: var(--dorado); text-transform: uppercase; }
        #carrito-barra { position: fixed; bottom: 0; width: 100%; background: var(--dorado); color: black; padding: 20px 0; display: none; justify-content: space-around; align-items: center; font-weight: bold; z-index: 1000; box-shadow: 0 -5px 20px rgba(0,0,0,0.5); }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.96); z-index: 2000; align-items: center; justify-content: center; overflow-y: auto; }
        .modal-content { background: var(--gris); padding: 30px; border: 1px solid var(--dorado); border-radius: 20px; width: 90%; max-width: 480px; text-align: center; }
        .quitar-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 20px 0; }
        .check-box { background: #252525; padding: 10px; border-radius: 5px; display: flex; align-items: center; justify-content: space-between; font-size: 0.8rem; }
        input, select { width: 100%; background: #000; color: white; border: 1px solid #444; padding: 12px; border-radius: 10px; margin-top: 10px; box-sizing: border-box; }
        .btn-gold { background: var(--dorado); color: black; border: none; padding: 15px; font-weight: bold; border-radius: 50px; cursor: pointer; text-transform: uppercase; width: 100%; margin-top: 10px; }
        .btn-outline { background: none; border: 1px solid var(--dorado); color: var(--dorado); padding: 12px; border-radius: 50px; cursor: pointer; width: 100%; margin-top: 10px; }
        .recibo { background: white; color: black; padding: 20px; font-family: 'Courier New', monospace; text-align: left; }
        @media (max-width: 768px) { .menu-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<header>
    <h1>Clandestino</h1>
    <div style="color: var(--dorado); letter-spacing: 3px; font-size: 0.8rem;">S츼NDWICHES GOURMET</div>
</header>

<div class="container">
    <div class="section-header">S츼NDWICHES</div>
    <div class="menu-grid" id="sandwiches-container"></div>
    <div class="section-header">BEBIDAS</div>
    <div class="menu-grid" id="bebidas-container"></div>
</div>

<div style="text-align: center; padding: 40px;">
    <p>Atenci칩n Personalizada:</p>
    <a href="tel:3104438759" style="color:var(--dorado); text-decoration:none; font-weight:bold; font-size:1.2rem;">游 3104438759</a>
</div>

<div id="carrito-barra">
    <span id="cart-count">PRODUCTOS: 0</span>
    <span id="cart-total">$0</span>
    <button onclick="abrirCheckout()" style="background:black; color:white; border:none; padding:10px 20px; border-radius:20px; font-weight:bold; cursor:pointer;">COMPRAR</button>
</div>

<div id="modal-personalizar" class="modal">
    <div class="modal-content">
        <h2 id="m-nombre" style="color:var(--dorado)"></h2>
        <div class="quitar-grid" id="m-ingredientes"></div>
        <button class="btn-gold" onclick="agregarAlCarrito()">AGREGAR AL CARRITO</button>
        <button class="btn-outline" onclick="cerrarModales()">AGREGAR M츼S PRODUCTOS</button>
    </div>
</div>

<div id="modal-checkout" class="modal">
    <div class="modal-content">
        <h2 style="color:var(--dorado)">FINALIZAR</h2>
        <div class="recibo" id="resumen-lista" style="font-size:0.8rem; margin-bottom:15px;"></div>
        <input type="text" id="c-direccion" placeholder="Direcci칩n y Barrio">
        <select id="c-metodo" onchange="toggleMetodo()">
            <option value="efectivo">EFECTIVO</option>
            <option value="electronico">ELECTR칍NICO</option>
        </select>
        <div id="pago-efectivo">
            <input type="number" id="c-cuanto" placeholder="쮺on cu치nto pagas?" oninput="calcularCambio()">
            <div id="vueltas-box" style="color:var(--dorado); font-weight:bold; margin-top:10px;">CAMBIO: $0</div>
        </div>
        <div id="pago-electronico" style="display:none; color:var(--dorado); font-size:0.7rem; padding:10px;">Opci칩n en desarrollo. Usa Efectivo.</div>
        <button class="btn-gold" id="btn-final" onclick="enviarPedido()">ENVIAR A COCINA</button>
        <button class="btn-outline" onclick="cerrarModales()">VOLVER</button>
    </div>
</div>

<script>
    const urlDB = "https://sandwich-clandestinos-default-rtdb.firebaseio.com/pedidos.json";
    let carrito = [];
    let seleccionado = null;

    const data = {
        s: [
            { n: "S치ndwich Tradicional", p: 4000, ing: ["Cebolla", "Tomate", "Pepino", "Lechuga", "Jam칩n", "Queso Cheddar"] },
            { n: "S치ndwich de Pollo", p: 6000, ing: ["Tomate", "Lechuga", "Huevo", "Pepinos", "Pollo Apanado"] },
            { n: "S치ndwich de Burger", p: 8000, ing: ["Queso", "Tomate", "Cebolla", "Pepinos", "Carne Burger"] },
            { n: "S치ndwich Subterr치neo", p: 7500, ing: ["Costilla BBQ", "Tomate", "Lechuga"] }
        ],
        b: [
            { n: "Mini Pepsi", p: 2000 }, { n: "Mini Manzana", p: 2000 }, { n: "Coca-Cola 1.5L", p: 8000 }, { n: "Jugo del Valle", p: 7000 }
        ]
    };

    function render() {
        const sCont = document.getElementById('sandwiches-container');
        data.s.forEach(x => { sCont.innerHTML += `<div class="menu-item" onclick="abrirP('${x.n}','s')"><div class="item-header"><span class="item-name">${x.n}</span><span>$${x.p}</span></div></div>`; });
        const bCont = document.getElementById('bebidas-container');
        data.b.forEach(x => { bCont.innerHTML += `<div class="menu-item" onclick="abrirP('${x.n}','b')"><div class="item-header"><span class="item-name">${x.n}</span><span>$${x.p}</span></div></div>`; });
    }

    function abrirP(n, t) {
        seleccionado = t==='s' ? data.s.find(i=>i.n===n) : data.b.find(i=>i.n===n);
        document.getElementById('m-nombre').innerText = seleccionado.n;
        const ingBox = document.getElementById('m-ingredientes');
        ingBox.innerHTML = seleccionado.ing ? seleccionado.ing.map(i => `<div class="check-box"><span>SIN ${i}</span><input type="checkbox" class="q-check" value="${i}"></div>`).join('') : "Listo para a침adir";
        document.getElementById('modal-personalizar').style.display = 'flex';
    }

    function agregarAlCarrito() {
        const q = Array.from(document.querySelectorAll('.q-check:checked')).map(c => c.value);
        carrito.push({ n: seleccionado.n, p: seleccionado.p, sin: q.join(", ") || "Nada" });
        document.getElementById('carrito-barra').style.display = 'flex';
        document.getElementById('cart-count').innerText = `PRODUCTOS: ${carrito.length}`;
        document.getElementById('cart-total').innerText = `$${carrito.reduce((a,b)=>a+b.p,0)}`;
        cerrarModales();
    }

    function abrirCheckout() {
        const res = document.getElementById('resumen-lista');
        const total = carrito.reduce((a,b)=>a+b.p,0);
        res.innerHTML = "<strong>RESUMEN:</strong><hr>" + carrito.map(i => `${i.n} ($${i.p})<br><small>Sin: ${i.sin}</small><br>`).join('') + `<hr><strong>TOTAL: $${total}</strong>`;
        document.getElementById('modal-checkout').style.display = 'flex';
    }

    function toggleMetodo() {
        const m = document.getElementById('c-metodo').value;
        document.getElementById('pago-efectivo').style.display = m==='efectivo'?'block':'none';
        document.getElementById('pago-electronico').style.display = m==='electronico'?'block':'none';
    }

    function calcularCambio() {
        const total = carrito.reduce((a,b)=>a+b.p,0);
        const paga = document.getElementById('c-cuanto').value || 0;
        document.getElementById('vueltas-box').innerText = "CAMBIO: $" + (paga-total > 0 ? paga-total : 0);
    }

    async function enviarPedido() {
        const dir = document.getElementById('c-direccion').value;
        if(!dir) return alert("Ingresa direcci칩n");
        const total = carrito.reduce((a,b)=>a+b.p,0);
        const paga = document.getElementById('c-cuanto').value || total;

        const pedido = {
            items: carrito,
            total: total,
            direccion: dir, // Cambiado de 'dir' a 'direccion'
            pagaCon: paga,  // Cambiado de 'paga' a 'pagaCon'
            cambio: paga - total,
            hora: new Date().toLocaleTimeString()
        };

        try {
            const response = await fetch(urlDB, { method: 'POST', body: JSON.stringify(pedido) });
            if(response.ok) {
                alert("PEDIDO ENVIADO EXITOSAMENTE");
                location.reload();
            }
        } catch (e) { alert("Error de conexi칩n"); }
    }

    function cerrarModales() { document.querySelectorAll('.modal').forEach(m => m.style.display='none'); }
    render();
</script>
</body>
</html>
